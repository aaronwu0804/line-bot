# 花生 AI 小幫手 - 增強功能說明

## 概述

花生 AI 小幫手已升級，新增了類似 Booboo 小幽的智能功能，包括：

- 🧠 **長期記憶管理**：使用 Mem0 或本地儲存管理用戶記憶
- 🎯 **意圖分類系統**：智能識別用戶意圖（待辦、連結、內容儲存、查詢、聊天）
- 📋 **待辦事項管理**：新增、查詢、更新待辦事項
- 💾 **內容分類儲存**：支援靈感、知識、記憶、音樂、活動等類型
- 🔗 **連結分析工具**：使用 Gemini URL Context 分析網頁內容
- 💬 **個人化對話**：基於用戶記憶提供個人化回應

## 新功能詳細說明

### 1. 意圖分類系統

花生會自動識別用戶訊息的意圖類型：

#### 意圖類型

- **todo（待辦事項）**
  - create: 新增待辦
  - update: 更新狀態
  - query: 查詢待辦

- **link（連結分享）**
  - 自動檢測並分析 URL
  - 提供網頁內容摘要

- **save_content（內容儲存）**
  - insight: 靈感記錄
  - knowledge: 知識儲存
  - memory: 一般記憶
  - music: 音樂相關
  - life: 活動記錄

- **query（查詢請求）**
  - feedback: 請求回饋/建議
  - recommendation: 請求推薦
  - chat_history: 查詢過往對話

- **other（一般聊天）**
  - 日常對話，無特定意圖

### 2. 長期記憶管理

#### Mem0 整合（可選）

如果設定了 `MEM0_API_KEY` 環境變數，花生會使用 Mem0 提供專業級記憶管理：

- **事實提取**：從對話中自動提取核心事實
- **記憶鞏固**：自動處理衝突、更新和刪除過時資訊
- **向量檢索**：快速搜尋相關記憶
- **關聯建立**：建立實體間的關係

#### 本地記憶管理（備援）

如果未設定 Mem0 API，花生會使用本地檔案系統儲存記憶：

- 儲存位置：`.cache/memories/`
- 格式：JSON 檔案
- 搜尋：基於關鍵字匹配

### 3. 待辦事項管理

#### 新增待辦

```
用戶：我明天要開會
花生：✅ 已新增待辦事項：
     我明天要開會
     截止日期：2026-02-25

用戶：提醒我買菜
花生：✅ 已新增待辦事項：
     提醒我買菜

用戶：今晚11:00看影片
花生：✅ 已新增待辦事項：
     今晚11:00看影片
     截止日期：2026-02-24
```

#### 查詢待辦

```
用戶：查看待辦
花生：📋 您的待辦事項：

     ⏳ 待完成：
     1. 我明天要開會 (截止：明天)
     2. 提醒我買菜
     3. 今晚11:00看影片 (截止：今天)
```

#### 完成待辦

```
用戶：開會完成了
花生：✅ 已更新 1 個待辦事項
```

### 4. 內容分類儲存

#### 儲存靈感

```
用戶：今天突然理解了慢即是快的道理
花生：✅ 已儲存到 💡 靈感

     內容：今天突然理解了慢即是快的道理
```

#### 儲存知識

```
用戶：學習了 React Hooks 的用法
花生：✅ 已儲存到 📚 知識

     內容：學習了 React Hooks 的用法
```

#### 儲存音樂

```
用戶：在 solo 陶喆的蝴蝶
花生：✅ 已儲存到 🎵 音樂

     內容：在 solo 陶喆的蝴蝶
```

#### 查詢內容

```
用戶：查看我的靈感記錄
花生：📝 您儲存的內容：

     💡 靈感：
     1. 今天突然理解了慢即是快的道理 (02/24)
     2. 讓 AI 當你的提問教練 (02/20)
```

### 5. 連結分析工具

當用戶分享連結時，花生會自動分析網頁內容：

```
用戶：https://techblog.lycorp.co.jp/zh-hant/Boo-Boo-LINE-AI-Assistant
花生：🔗 連結分析結果：

     📌 網址：https://techblog.lycorp.co.jp/zh-hant/Boo-Boo-LINE-AI-Assistant

     【網頁標題】
     Booboo 小幽 —— 打造你的第二個大腦

     【主要內容摘要】
     本文介紹了如何建立一個真正懂你的 LINE AI 智慧助理...

     【關鍵要點】
     1. 使用 Mem0 進行長期記憶管理
     2. 意圖分類系統設計
     3. Gemini API 連結分析工具
     ...
```

### 6. 個人化對話

花生會根據用戶的記憶提供個人化回應：

```
用戶：推薦一些音樂
花生：🤔 讓我想想...

     根據我的記憶：
     - 你最近在 solo 陶喆的蝴蝶

     根據你的音樂喜好，我推薦以下歌曲...
```

## 使用方式

### 呼叫花生

使用以下任一前綴來呼叫花生：

- `AI: 你的問題`
- `@AI 你的問題`
- `小幫手，你的問題`
- `花生，你的問題`

### 連續對話

開始對話後，可以直接提問，無需再加前綴：

```
用戶：花生，你好
花生：你好！有什麼我可以幫助你的嗎？

用戶：推薦一些書給我
花生：當然！根據你的興趣...

用戶：謝謝
花生：不客氣！如果還有其他需要，隨時告訴我！
```

## 環境設定

### 必要環境變數

```bash
# LINE Bot 設定
LINE_CHANNEL_ACCESS_TOKEN=your_line_channel_access_token
LINE_CHANNEL_SECRET=your_line_channel_secret

# Google Gemini API
GEMINI_API_KEY=your_gemini_api_key
```

### 可選環境變數

```bash
# Mem0 記憶管理（可選，不設定則使用本地儲存）
MEM0_API_KEY=your_mem0_api_key
```

## 資料儲存

### 本地儲存位置

所有資料儲存在 `.cache/` 目錄下：

```
.cache/
├── memories/        # 記憶儲存
│   └── {user_id}.json
├── todos/          # 待辦事項
│   └── {user_id}_todos.json
├── contents/       # 內容儲存
│   └── {user_id}_contents.json
└── links/          # 連結儲存
    └── {user_id}_links.json
```

### 資料格式

所有資料以 JSON 格式儲存，包含：

- ID（唯一識別碼）
- 內容
- 類型/狀態
- 時間戳記
- 元數據

## 技術架構

### 模組結構

```
src/
├── intent_classifier.py    # 意圖分類器
├── memory_manager.py       # 記憶管理器
├── todo_manager.py         # 待辦事項管理器
├── content_manager.py      # 內容管理器
├── link_analyzer.py        # 連結分析器
└── peanut_assistant.py     # 整合服務
```

### 處理流程

1. **接收訊息** → 用戶發送訊息給花生
2. **意圖分類** → 使用 Gemini API 或規則分類意圖
3. **路由處理** → 根據意圖類型執行對應操作
4. **記憶管理** → 儲存重要資訊到長期記憶
5. **生成回應** → 結合記憶和 AI 生成個人化回應
6. **返回結果** → 回覆用戶

## 最佳實踐

### 1. 清楚表達意圖

明確的指令會得到更好的回應：

✅ **好的範例**
- "我明天下午3點要開會"
- "查看本週的待辦事項"
- "今天學習了 Python 的裝飾器"

❌ **模糊的範例**
- "會議"（缺少時間和上下文）
- "看看"（不明確要查看什麼）

### 2. 使用標籤和分類

儲存內容時，花生會自動分類：

```
靈感：「今天突然理解了...」
知識：「學習了...」
音樂：「在 solo...」
活動：「去了...」
```

### 3. 定期查看和整理

建議定期查看儲存的內容：

```
查看待辦
查看我的靈感記錄
最近儲存了哪些知識
```

## 限制和注意事項

### 1. Gemini API 配額

- 免費配額有限制
- 建議合理使用，避免頻繁請求

### 2. 連結分析

- 僅支援 HTTP/HTTPS 連結
- 某些網站可能有爬蟲限制
- PDF 分析需要特定格式支援

### 3. 資料安全

- 本地儲存未加密
- 不建議儲存敏感資訊
- 定期備份重要資料

## 常見問題

### Q: Mem0 API 是必需的嗎？

A: 不是。如果不設定 `MEM0_API_KEY`，花生會自動使用本地檔案系統儲存記憶。

### Q: 如何清除所有資料？

A: 刪除 `.cache/` 目錄下的對應檔案即可。

### Q: 支援多用戶嗎？

A: 是的，系統使用 `user_id` 區分不同用戶的資料。

### Q: 如何更新 Gemini API 版本？

A: 更新 `requirements.txt` 中的 `google-generativeai` 版本，然後重新安裝依賴。

## 更新日誌

### v2.0.0 (2026-02-24)

- ✨ 新增意圖分類系統
- ✨ 整合 Mem0 長期記憶管理
- ✨ 新增待辦事項管理功能
- ✨ 新增內容分類儲存功能
- ✨ 新增連結分析工具（URL Context）
- ✨ 個人化對話回應
- 📝 完整的使用文檔

## 貢獻

歡迎提供建議和改進！

## 授權

此專案為個人學習專案。

---

🌟 **花生 AI 小幫手祝您使用愉快！**
